{"version":3,"file":"commonHelpers.js","sources":["../src/main.js"],"sourcesContent":["import iziToast from \"izitoast\";\nimport \"izitoast/dist/css/iziToast.min.css\";\nimport SimpleLightbox from \"simplelightbox\";\nimport \"simplelightbox/dist/simple-lightbox.min.css\";\nimport axios from 'axios';\n\nconst API_KEY = \"41829655-bf270f19af5dfab9e341d37e3\";\n\nconst cardContainer = document.querySelector(\".card-container\");\nconst searchForm = document.querySelector(\".search-form\");\nconst loader = document.querySelector(\".loader\");\nconst fetchMoreBtn = document.querySelector(\".btn-more-primary\");\n\nsearchForm.addEventListener(\"submit\", handleSearch);\nfetchMoreBtn.addEventListener(\"click\", fetchMorePhotos);\n\nlet page = 1;\nlet limit = 40;\nlet totalPages = 1;\nlet lastQuery = \"\";\nlet endMessage = null;\nlet cardHeight = 0;\n\nfetchMoreBtn.style.display = \"none\";\n\nconst lightbox = new SimpleLightbox(\".card-container a\", {\n  captionsData: \"alt\",\n  captionDelay: 250,\n});\n\nfunction measureCardHeight() {\n  const firstCard = document.querySelector('.gallery-item');\n  if (firstCard) {\n    const cardRect = firstCard.getBoundingClientRect();\n    cardHeight = cardRect.height;\n  }\n}\n\nfunction afterRender() {\n  lightbox.refresh();\n  measureCardHeight();\n}\n\nasync function fetchMorePhotos() {\n  if (page > totalPages) {\n    return;\n  }\n  \n  showLoader();\n  fetchMoreBtn.disabled = true; \n\n  try {\n    page += 1;\n    const data = await fetchPhotos(lastQuery, page, limit);\n    renderPhotos(data);\n    if (page >= totalPages) {\n      fetchMoreBtn.style.display = \"none\";\n      showEndMessage();\n    }\n    afterRender();\n  } catch (error) {\n    console.log(error);\n  } finally {\n    hideLoader();\n    fetchMoreBtn.disabled = false; \n    scrollToNextGroup();\n  }\n}\n\nfunction scrollToNextGroup() {\n  window.scrollBy({\n    top: 2 * cardHeight,\n    behavior: 'smooth',\n  });\n}\n\nasync function handleSearch(event) {\n  event.preventDefault();\n\n  const form = event.currentTarget;\n  const query = form.elements.query.value;\n\n  if (!query.trim()) {\n    return;\n  }\n  \n  clearGallery();\n  showLoader();\n  fetchMoreBtn.disabled = true; \n\n  try {\n    const data = await fetchPhotos(query, page, limit);\n    renderPhotos(data);\n    totalPages = Math.ceil(data.totalHits / limit); \n    page = 1;\n    lastQuery = query;\n    if (data.hits.length === 0) {\n      fetchMoreBtn.style.display = \"none\";\n    } else {\n      fetchMoreBtn.style.display = \"block\";\n    }\n    afterRender();\n  } catch (error) {\n    onFetchError(error);\n  } finally {\n    form.reset();\n    hideLoader();\n    fetchMoreBtn.disabled = false; \n  }\n}\n\n\nasync function fetchPhotos(query, page, limit) {\n  const url = `https://pixabay.com/api/?key=${API_KEY}&q=${query}&image_type=photo&orientation=horizontal&safesearch=true&page=${page}&per_page=${limit}`;\n\n  try {\n    const response = await axios.get(url);\n    return response.data;\n  } catch (error) {\n    throw new Error('Failed to fetch photos');\n  }\n}\n\nfunction renderPhotos(data) {\n  const photos = data.hits || [];\n\n  if (photos.length === 0) {\n    onFetchError(new Error(\"No images found.\"));\n    return;\n  }\n\n  const markup = photos\n    .map(\n      ({ webformatURL, largeImageURL, tags, likes, views, comments, downloads }) =>\n        `\n        <li class=\"gallery-item\">\n            <a href=\"${largeImageURL}\" class=\"gallery-link\">\n                <img \n                class=\"gallery-image\" \n                src=\"${webformatURL}\" \n                alt=\"${tags}\"\n                width=\"360\" \n                height=\"200\"\n                />\n                <ul class=\"gallery-item-description\">\n                    <li class=\"comments\" >Likes: ${likes}</li>\n                    <li class=\"comments\" >Views: ${views}</li>\n                    <li class=\"comments\" >Downloads: ${downloads}</li>\n                    <li class=\"comments\" >Comments: ${comments}</li>\n                </ul>\n            </a>\n        </li>\n        `\n    )\n    .join(\"\");\n\n  cardContainer.innerHTML += markup;\n  lightbox.refresh();\n}\n\nfunction onFetchError(error) {\n  iziToast.show({\n    position: 'topRight',\n    messageColor: '#FFF',\n    messageSize: \"16px\",\n    close: false,\n    backgroundColor: '#EF4040',\n    message: \"Sorry, there are no images matching your search query. Please try again!\",\n  });\n}\n\nfunction clearGallery() {\n  cardContainer.innerHTML = \"\";\n}\n\nfunction showLoader() {\n  loader.classList.add(\"visible\");\n}\n\nfunction hideLoader() {\n  loader.classList.remove(\"visible\");\n}\n\nfunction showEndMessage() {\n  endMessage = iziToast.show({\n    class: 'error-svg',\n    position: \"topRight\",\n    icon: 'error-svg',\n    messageColor: '#FFF',\n    messageSize: \"16px\",\n    close: false,\n    backgroundColor: '#EF4040',\n    message: \"We're sorry, but you've reached the end of search results.\"\n  });\n}\n\n\n"],"names":["API_KEY","cardContainer","searchForm","loader","fetchMoreBtn","handleSearch","fetchMorePhotos","page","limit","totalPages","lastQuery","cardHeight","lightbox","SimpleLightbox","measureCardHeight","firstCard","afterRender","showLoader","data","fetchPhotos","renderPhotos","showEndMessage","error","hideLoader","scrollToNextGroup","event","form","query","clearGallery","onFetchError","url","axios","photos","markup","webformatURL","largeImageURL","tags","likes","views","comments","downloads","iziToast"],"mappings":"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"}